plink_bin = genetics.binaRies::get_plink_binary(),
bfile = "/campaign/VB-FM5HPC-001/Vilte/Projects/MR-mediation/metabolites/EUR/EUR",
clump_kb = 10000,
clump_r2 = 0.001,
clump_p = 0.00000005,
pop = "EUR" )
clumped_snps <- ieugwasr::ld_clump(dplyr::tibble(rsid=exp_dat$SNP, pval=exp_dat$pval.exposure, id=exp_dat$id.exposure),
plink_bin = genetics.binaRies::get_plink_binary(),
bfile = "/campaign/VB-FM5HPC-001/Vilte/Projects/MR-mediation/metabolites/EUR/EUR",
clump_kb = 10000,
clump_r2 = 0.001,
clump_p = 0.00000005,
pop = "EUR" )
clumped_snps <- ieugwasr::ld_clump(
dplyr::tibble(rsid = exp_dat$SNP, pval = exp_dat$pval.exposure, id = exp_dat$id.exposure),
plink_bin = ieugwasr::get_plink_binary(),
bfile = "/campaign/VB-FM5HPC-001/Vilte/Projects/MR-mediation/metabolites/EUR/EUR",
clump_kb = 10000,
clump_r2 = 0.001,
clump_p = 5e-8,
pop = "EUR"
)
if (!requireNamespace("ieugwasr", quietly = TRUE)) {
install.packages("ieugwasr")
}
library(ieugwasr)
clumped_snps <- ieugwasr::ld_clump(dplyr::tibble(rsid=exp_dat$SNP, pval=exp_dat$pval.exposure, id=exp_dat$id.exposure),
plink_bin = genetics.binaRies::get_plink_binary(),
bfile = "/campaign/VB-FM5HPC-001/Vilte/Projects/MR-mediation/metabolites/EUR/EUR",
clump_kb = 10000,
clump_r2 = 0.001,
clump_p = 0.00000005,
pop = "EUR" )
format_data
clumped_snps <-  clump_data(
exp_dat,
clump_kb = 10000,
clump_r2 = 0.001,
clump_p1 = 1,
clump_p2 = 1,
pop = "EUR",
bfile = NULL,
plink_bin = NULL
)
clumped_snps <- ieugwasr::ld_clump(dplyr::tibble(rsid=exp_dat$SNP, pval=exp_dat$pval.exposure, id=exp_dat$id.exposure),
plink_bin = genetics.binaRies::get_plink_binary(),
bfile = "/Users/naveennainwal/Tools/EUR/EUR",
clump_kb = 10000,
clump_r2 = 0.001,
clump_p = 0.00000005,
pop = "EUR" )
install.packages("genetics.binaRies", repos = c("https://mrcieu.r-universe.dev", "https://cloud.r-project.org"))
clumped_snps <- ieugwasr::ld_clump(dplyr::tibble(rsid=exp_dat$SNP, pval=exp_dat$pval.exposure, id=exp_dat$id.exposure),
plink_bin = genetics.binaRies::get_plink_binary(),
bfile = "/Users/naveennainwal/Tools/EUR/EUR",
clump_kb = 10000,
clump_r2 = 0.001,
clump_p = 0.00000005,
pop = "EUR" )
clumped_snps <- ieugwasr::ld_clump(dplyr::tibble(rsid=exp_dat$SNP, pval=exp_dat$pval.exposure, id=exp_dat$id.exposure),
plink_bin = genetics.binaRies::get_plink_binary(),
bfile = "/Users/naveennainwal/Tools/EUR/EUR",
clump_kb = 10000,
clump_r2 = 0.001,
clump_p = 0.00000005,
pop = "EUR" )
clumped_snps <- ieugwasr::ld_clump(dplyr::tibble(rsid=exp_dat$SNP, pval=exp_dat$pval.exposure, id=exp_dat$id.exposure),
plink_bin = "~/Tools/plink_folder/plink", # genetics.binaRies::get_plink_binary(),
bfile = "/Users/naveennainwal/Tools/EUR/EUR",
clump_kb = 10000,
clump_r2 = 0.001,
clump_p = 0.00000005,
pop = "EUR" )
clumped_snps <- ieugwasr::ld_clump(dplyr::tibble(rsid=exp_dat$SNP, pval=exp_dat$pval.exposure, id=exp_dat$id.exposure),
plink_bin = "~/Tools/plink_folder/", # genetics.binaRies::get_plink_binary(),
bfile = "/Users/naveennainwal/Tools/EUR/EUR",
clump_kb = 10000,
clump_r2 = 0.001,
clump_p = 0.00000005,
pop = "EUR" )
clumped_snps <- ieugwasr::ld_clump(dplyr::tibble(rsid=exp_dat$SNP, pval=exp_dat$pval.exposure, id=exp_dat$id.exposure),
plink_bin = "~/Tools/plink_folder", # genetics.binaRies::get_plink_binary(),
bfile = "/Users/naveennainwal/Tools/EUR/EUR",
clump_kb = 10000,
clump_r2 = 0.001,
clump_p = 0.00000005,
pop = "EUR" )
clumped_snps <- ieugwasr::ld_clump(dplyr::tibble(rsid=exp_dat$SNP, pval=exp_dat$pval.exposure, id=exp_dat$id.exposure),
plink_bin = "/Users/naveennainwal/Tools/plink_folder/plink", # genetics.binaRies::get_plink_binary(),
bfile = "/Users/naveennainwal/Tools/EUR/EUR",
clump_kb = 10000,
clump_r2 = 0.001,
clump_p = 0.00000005,
pop = "EUR" )
exp_dat_clumped <- subset(exp_dat, SNP %in% clumped_snps$rsid)
dim(exp_dat_clumped)
head(exp_dat_clumped)
out <- read_outcome_data(
snps = exp_dat_clumped$SNP,
filename = paste0("longevity_90th_percentile_rsid.txt"), # no eaf in sumstats
sep = "\t", snp_col = "SNP",
beta_col = "Beta", se_col = "SE",
effect_allele_col = "EA", other_allele_col = "NEA",
pval_col = "P-value", eaf_col = 'EAF')
out <- read_outcome_data(
snps = exp_dat_clumped$SNP,
filename = "sumstats/longevity_90th_percentile_rsid.txt.gz", # no eaf in sumstats
sep = "\t", snp_col = "SNP",
beta_col = "Beta", se_col = "SE",
effect_allele_col = "EA", other_allele_col = "NEA",
pval_col = "P-value", eaf_col = 'EAF')
out$outcome <- "Longevity-90th-percentile"
dat <- harmonise_data(
exposure_dat = exp_dat_clumped,
outcome_dat = out)
egger_intercept_b <- mr_pleiotropy_test(dat)
dim(dat)
egger_intercept_b
head(dat)
# Horizontal pleiotropy
# The intercept term in MR Egger regression can be a useful indication of whether directional horizontal pleiotropy is driving the results of an MR analysis.
egger_intercept_b <- mr_pleiotropy_test(dat)
dat
head(exp_dat_clumped)
table(dat$palindromic, dat$mr_keep.exposure)
table(dat$ambiguous, dat$mr_keep.exposure)
subset(dat, mr_keep.exposure == FALSE)[, c("SNP", "effect_allele.exposure", "other_allele.exposure",
"effect_allele.outcome", "other_allele.outcome")]
subset(dat, mr_keep.exposure == FALSE)[, c("SNP", "beta.exposure", "beta.outcome", "se.exposure", "se.outcome")]
head(gwas)
-0.0014478164/0.006262708
exp_dat <- format_data(gwas, type = "exposure",
snp_col = "SNP", beta_col = "est",
se_col = "se_c", effect_allele_col = "A1",
other_allele_col = "A2", pval_col = "Pval_Estimate",
samplesize_col = "N",
min_pval = 1e-200)
clumped_snps <- ieugwasr::ld_clump(dplyr::tibble(rsid=exp_dat$SNP, pval=exp_dat$pval.exposure, id=exp_dat$id.exposure),
plink_bin = "/Users/naveennainwal/Tools/plink_folder/plink", # genetics.binaRies::get_plink_binary(),
bfile = "/Users/naveennainwal/Tools/EUR/EUR",
clump_kb = 10000,
clump_r2 = 0.001,
clump_p = 0.00000005,
pop = "EUR" )
# keep only clumped snps
exp_dat_clumped <- subset(exp_dat, SNP %in% clumped_snps$rsid)
out <- read_outcome_data(
snps = exp_dat_clumped$SNP,
filename = "sumstats/longevity_90th_percentile_rsid.txt.gz", # no eaf in sumstats
sep = "\t", snp_col = "SNP",
beta_col = "Beta", se_col = "SE",
effect_allele_col = "EA", other_allele_col = "NEA",
pval_col = "P-value", eaf_col = 'EAF')
out$outcome <- "Longevity-90th-percentile"
dat <- harmonise_data(
exposure_dat = exp_dat_clumped,
outcome_dat = out)
# Horizontal pleiotropy
# The intercept term in MR Egger regression can be a useful indication of whether directional horizontal pleiotropy is driving the results of an MR analysis.
egger_intercept_b <- mr_pleiotropy_test(dat)
# Heterogeneity statistic
Q_b <- mr_heterogeneity(dat)
res <- mr(dat, method_list = c("mr_ivw", "mr_weighted_median", "mr_egger_regression"))
res
# save all output
openxlsx::write.xlsx(list(res = res, egger_intercept = egger_intercept_b, Q_df = Q_b), file = paste0("/results/brainageFactor-on-longevity-", Sys.Date(), ".xlsx"), rowNames = F, overwrite = T)
install.packages("openxlsx")
# save all output
openxlsx::write.xlsx(list(res = res, egger_intercept = egger_intercept_b, Q_df = Q_b), file = paste0("/results/brainageFactor-on-longevity-", Sys.Date(), ".xlsx"), rowNames = F, overwrite = T)
# Read longevity GWAS (now as exposure)
longevity <- fread("sumstats/longevity_90th_percentile_rsid.txt.gz")
longevity$Phenotype <- "Longevity-90th-percentile"
# Optional: reduce to suggestive SNPs for clumping
longevity <- longevity %>% filter(`P-value` < 5e-6)
res
# save all output
openxlsx::write.xlsx(list(res = res, egger_intercept = egger_intercept_b, Q_df = Q_b), file = paste0("results/brainageFactor-on-longevity-", Sys.Date(), ".xlsx"), rowNames = F, overwrite = T)
head(longevity)
# Optional: reduce to suggestive SNPs for clumping
longevity <- longevity %>% filter(`P-value` < 5e-6)
dim(longevity)
# Format as exposure data
exp_dat <- format_data(longevity, type = "exposure",
snp_col = "SNP", beta_col = "Beta",
se_col = "SE", effect_allele_col = "EA",
other_allele_col = "NEA", pval_col = "P-value",
eaf_col = "EAF", samplesize_col = "Effective_N",
min_pval = 1e-200)
longevity <- as.data.frame(longevity)
longevity <- as.data.frame(longevity)
exp_dat <- format_data(longevity, type = "exposure",
snp_col = "SNP", beta_col = "Beta",
se_col = "SE", effect_allele_col = "EA",
other_allele_col = "NEA", pval_col = "P-value",
eaf_col = "EAF", samplesize_col = "Effective_N",
min_pval = 1e-200)
clumped_snps <- ieugwasr::ld_clump(
dplyr::tibble(rsid = exp_dat$SNP, pval = exp_dat$pval.exposure, id = exp_dat$id.exposure),
plink_bin = "/Users/naveennainwal/Tools/plink_folder/plink",
bfile = "/Users/naveennainwal/Tools/EUR/EUR",
clump_kb = 10000, clump_r2 = 0.001, clump_p = 5e-8, pop = "EUR"
)
exp_dat_clumped <- subset(exp_dat, SNP %in% clumped_snps$rsid)
out <- read_outcome_data(
snps = exp_dat_clumped$SNP,
filename = "brainage_factor_withSmith_withN.txt.gz",
sep = "\t", snp_col = "SNP", beta_col = "est", se_col = "se_c",
effect_allele_col = "A1", other_allele_col = "A2",
pval_col = "Pval_Estimate", samplesize_col = "N"
)
out$outcome <- "BrainAgeFactor"
dat <- harmonise_data(
exposure_dat = exp_dat_clumped,
outcome_dat = out
)
res <- mr(dat, method_list = c("mr_ivw", "mr_weighted_median", "mr_egger_regression"))
egger_intercept <- mr_pleiotropy_test(dat)
Q <- mr_heterogeneity(dat)
openxlsx::write.xlsx(
list(res = res, egger_intercept = egger_intercept, Q_df = Q),
file = paste0("results/longevity-on-brainageFactor-", Sys.Date(), ".xlsx"),
rowNames = FALSE, overwrite = TRUE
)
clumped_snps <- ieugwasr::ld_clump(
dplyr::tibble(rsid = exp_dat$SNP, pval = exp_dat$pval.exposure, id = exp_dat$id.exposure),
plink_bin = "/Users/naveennainwal/Tools/plink_folder/plink",
bfile = "/Users/naveennainwal/Tools/EUR/EUR",
clump_kb = 10000, clump_r2 = 0.001, clump_p = 5e-6, pop = "EUR"
)
exp_dat_clumped <- subset(exp_dat, SNP %in% clumped_snps$rsid)
out <- read_outcome_data(
snps = exp_dat_clumped$SNP,
filename = "brainage_factor_withSmith_withN.txt.gz",
sep = "\t", snp_col = "SNP", beta_col = "est", se_col = "se_c",
effect_allele_col = "A1", other_allele_col = "A2",
pval_col = "Pval_Estimate", samplesize_col = "N"
)
out$outcome <- "BrainAgeFactor"
dat <- harmonise_data(
exposure_dat = exp_dat_clumped,
outcome_dat = out
)
res <- mr(dat, method_list = c("mr_ivw", "mr_weighted_median", "mr_egger_regression"))
egger_intercept <- mr_pleiotropy_test(dat)
Q <- mr_heterogeneity(dat)
res
openxlsx::write.xlsx(list(res = res, egger_intercept = egger_intercept_b, Q_df = Q_b), file = paste0("ENIGMA-brainPAD-on-T2D-5e6-", Sys.Date(), ".xlsx"), rowNames = F, overwrite = T)
openxlsx::write.xlsx(list(res = res, egger_intercept = egger_intercept, Q_df = Q), file = paste0("results/longevity-on-brainageFactor-5e6-", Sys.Date(), ".xlsx"), rowNames = FALSE, overwrite = TRUE)
# 1. Load and format T2D GWAS as exposure
t2d_gwas <- fread("Mahajan.NatGenet2018b.T2D.European_mapped_CHR_ALL.txt.gz")
t2d_gwas$Phenotype <- "T2D"
getwd()
dir()
# 1. Load and format T2D GWAS as exposure
t2d_gwas <- fread("sumstats/Mahajan.NatGenet2018b.T2D.European_mapped_CHR_ALL.txt.gz")
t2d_gwas$Phenotype <- "T2D"
head(t2d_gwas)
gc()
rm(longevity)
gc()
# Format as exposure
exp_dat <- format_data(t2d_gwas, type = "exposure",
snp_col = "RSID", beta_col = "Beta",
se_col = "SE", effect_allele_col = "A1",
other_allele_col = "A2", pval_col = "P-value",
eaf_col = "EAF",
samplesize_col = "Neff",
min_pval = 1e-200)
t2d_gwas<- as.data.frame(t2d_gwas)
# Format as exposure
exp_dat <- format_data(t2d_gwas, type = "exposure",
snp_col = "RSID", beta_col = "Beta",
se_col = "SE", effect_allele_col = "A1",
other_allele_col = "A2", pval_col = "P-value",
eaf_col = "EAF",
samplesize_col = "Neff",
min_pval = 1e-200)
# Format as exposure
exp_dat <- format_data(t2d_gwas, type = "exposure",
snp_col = "RSID", beta_col = "Beta",
se_col = "SE", effect_allele_col = "A1",
other_allele_col = "A2", pval_col = "P-value",
eaf_col = "EAF",
samplesize_col = "Neff",
min_pval = 1e-200)
head(exp_dat)
# 2. LD clumping
clumped_snps <- ieugwasr::ld_clump(
dplyr::tibble(rsid = exp_dat$SNP, pval = exp_dat$pval.exposure, id = exp_dat$id.exposure),
plink_bin = "/Users/naveennainwal/Tools/plink_folder/plink",
bfile = "/Users/naveennainwal/Tools/EUR/EUR",
clump_kb = 10000, clump_r2 = 0.001, clump_p = 5e-8, pop = "EUR"
)
exp_dat_clumped <- subset(exp_dat, SNP %in% clumped_snps$rsid)
out <- read_outcome_data(
snps = exp_dat_clumped$SNP,
filename = "brainage_factor_withSmith_withN.txt.gz",
sep = "\t", snp_col = "SNP",
beta_col = "est", se_col = "se_c",
effect_allele_col = "A1", other_allele_col = "A2",
pval_col = "Pval_Estimate", samplesize_col = "N"
)
out$outcome <- "BrainAgeFactor"
# 4. Harmonise exposure and outcome
dat <- harmonise_data(
exposure_dat = exp_dat_clumped,
outcome_dat = out
)
res <- mr(dat, method_list = c("mr_ivw", "mr_weighted_median", "mr_egger_regression"))
egger_intercept <- mr_pleiotropy_test(dat)
Q <- mr_heterogeneity(dat)
res
# 6. Save results to Excel
openxlsx::write.xlsx(
list(res = res, egger_intercept = egger_intercept, Q_df = Q),
file = paste0("results/T2D-on-brainageFactor-", Sys.Date(), ".xlsx"),
rowNames = FALSE, overwrite = TRUE
)
library(TwoSampleMR)
#library(ggplot2)
library(data.table)
library(ieugwasr)
setwd("/Users/naveennainwal/Documents/Vilte-2025/2025/3.MR/")
# brain age factor on longevity
gwas <- fread("brainage_factor_withSmith_withN.txt.gz")
head(gwas)
gwas <- as.data.frame(gwas)
# format exposure data
gwas$Phenotype <- "brainageFactor"
# reduce the size of the dataset to only suggestive SNPs (makes it faster to clump later)
gwas <- gwas %>% filter(Pval_Estimate < 0.000005)
head(gwas)
# reduce the size of the dataset to only suggestive SNPs (makes it faster to clump later)
gwas <- gwas %>% filter(Pval_Estimate < 0.000005)
library(TwoSampleMR)
#library(ggplot2)
library(data.table)
library(ieugwasr)
setwd("/Users/naveennainwal/Documents/Vilte-2025/2025/3.MR/")
# brain age factor on longevity
gwas <- fread("brainage_factor_withSmith_withN.txt.gz")
head(gwas)
gwas <- as.data.frame(gwas)
# format exposure data
gwas$Phenotype <- "brainageFactor"
# reduce the size of the dataset to only suggestive SNPs (makes it faster to clump later)
gwas <- gwas[gwas$Pval_Estimate < 5e-6, ]
exp_dat <- format_data(gwas, type = "exposure",
snp_col = "SNP", beta_col = "est",
se_col = "se_c", effect_allele_col = "A1",
other_allele_col = "A2", pval_col = "Pval_Estimate",
samplesize_col = "N",
min_pval = 1e-200)
clumped_snps <- ieugwasr::ld_clump(dplyr::tibble(rsid=exp_dat$SNP, pval=exp_dat$pval.exposure, id=exp_dat$id.exposure),
plink_bin = "/Users/naveennainwal/Tools/plink_folder/plink", # genetics.binaRies::get_plink_binary(),
bfile = "/Users/naveennainwal/Tools/EUR/EUR",
clump_kb = 10000,
clump_r2 = 0.001,
clump_p = 0.00000005,
pop = "EUR" )
# keep only clumped snps
exp_dat_clumped <- subset(exp_dat, SNP %in% clumped_snps$rsid)
out <- read_outcome_data(
snps = exp_dat_clumped$SNP,
filename = paste0("Mahajan.NatGenet2018b.T2D.European_mapped_CHR_ALL.txt.gz"), # no eaf in sumstats
sep = "\t", snp_col = "RSID",
beta_col = "Beta", se_col = "SE",
effect_allele_col = "A1", other_allele_col = "A2",
pval_col = "P-value", eaf_col = 'EAF')
out <- read_outcome_data(
snps = exp_dat_clumped$SNP,
filename = paste0("sumstats/Mahajan.NatGenet2018b.T2D.European_mapped_CHR_ALL.txt.gz"), # no eaf in sumstats
sep = "\t", snp_col = "RSID",
beta_col = "Beta", se_col = "SE",
effect_allele_col = "A1", other_allele_col = "A2",
pval_col = "P-value", eaf_col = 'EAF')
out$outcome <- "T2D"
dat <- harmonise_data(
exposure_dat = exp_dat_clumped,
outcome_dat = out)
# Horizontal pleiotropy
# The intercept term in MR Egger regression can be a useful indication of whether directional horizontal pleiotropy is driving the results of an MR analysis.
egger_intercept_b <- mr_pleiotropy_test(dat)
# Heterogeneity statistic
Q_b <- mr_heterogeneity(dat)
res <- mr(dat, method_list = c("mr_ivw", "mr_weighted_median", "mr_egger_regression"))
# save all output
openxlsx::write.xlsx(list(res = res, egger_intercept = egger_intercept_b, Q_df = Q_b), file = paste0("brainageFactor-on-T2D-", Sys.Date(), ".xlsx"), rowNames = F, overwrite = T)
res
getwd()
dir()
# read in table with all MR output for ENIGMA brain PAD
df_mr <-openxlsx::read.xlsx("/Users/naveennainwal/Documents/Vilte-2025/2025/3.MR/combined-results.xlsx")
forest_plot_1 <- ggplot(df_mr, aes(y = exposure, x = b, xmin = lCI, xmax = hCI, color = method)) +
geom_point(position = position_dodge(width = -0.5), size = 3.5, shape = 16) +  # Larger points, circular shape
geom_errorbarh(aes(xmin = lCI, xmax = hCI), position = position_dodge(width = -0.5), height = 0.70, size = 0.8) +  # Thicker error bars
geom_vline(xintercept = 0, linetype = "dashed", color = "black", size = 0.8) +  # Black dashed line
labs(title = "ENIGMA brain-PAD", x = "b (95% CI)", y = NULL) +  # Set y-axis label to NULL
theme_minimal(base_size = 14) +  # Slightly larger base text size for clarity
scale_color_manual(values = c("#FB8072","#FDB462" , "#8DD3C7")) +  # Nicer, cohesive color palette (green, orange, purple)
theme(panel.border = element_rect(color = "grey70", fill = NA, size = 1.5),  # Thicker, lighter grey border
panel.grid.major.x = element_line(color = "grey85", size = 0.5),  # Subtle horizontal grid lines
panel.grid.minor.x = element_blank(),  # Remove minor grid lines
panel.grid.major.y = element_blank(),  # Remove vertical grid lines
plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),  # Centered and bold title
axis.text.y = element_text(size = 12),  # Normal (non-italic) y-axis labels
legend.position = "right",  # Move the legend to the top
legend.title = element_blank()) +  # Remove the legend title
scale_fill_brewer(palette = "Set3")
library(ggplot)
install.packages(ggplot2)
install.packages("ggplot2")
library(ggplot2)
forest_plot_1 <- ggplot(df_mr, aes(y = exposure, x = b, xmin = lCI, xmax = hCI, color = method)) +
geom_point(position = position_dodge(width = -0.5), size = 3.5, shape = 16) +  # Larger points, circular shape
geom_errorbarh(aes(xmin = lCI, xmax = hCI), position = position_dodge(width = -0.5), height = 0.70, size = 0.8) +  # Thicker error bars
geom_vline(xintercept = 0, linetype = "dashed", color = "black", size = 0.8) +  # Black dashed line
labs(title = "ENIGMA brain-PAD", x = "b (95% CI)", y = NULL) +  # Set y-axis label to NULL
theme_minimal(base_size = 14) +  # Slightly larger base text size for clarity
scale_color_manual(values = c("#FB8072","#FDB462" , "#8DD3C7")) +  # Nicer, cohesive color palette (green, orange, purple)
theme(panel.border = element_rect(color = "grey70", fill = NA, size = 1.5),  # Thicker, lighter grey border
panel.grid.major.x = element_line(color = "grey85", size = 0.5),  # Subtle horizontal grid lines
panel.grid.minor.x = element_blank(),  # Remove minor grid lines
panel.grid.major.y = element_blank(),  # Remove vertical grid lines
plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),  # Centered and bold title
axis.text.y = element_text(size = 12),  # Normal (non-italic) y-axis labels
legend.position = "right",  # Move the legend to the top
legend.title = element_blank()) +  # Remove the legend title
scale_fill_brewer(palette = "Set3")
print(forest_plot_1)
library(TwoSampleMR)
#library(ggplot2)
library(data.table)
library(ieugwasr)
#install.packages("genetics.binaRies", repos = c("https://mrcieu.r-universe.dev", "https://cloud.r-project.org"))
setwd("/Users/naveennainwal/Documents/Vilte-2025/2025/3.MR/")
# brain age factor on longevity
gwas <- fread("brainage_factor_withSmith_withN.txt.gz")
head(gwas)
gwas <- as.data.frame(gwas)
# format exposure data
gwas$Phenotype <- "brainageFactor"
# reduce the size of the dataset to only suggestive SNPs (makes it faster to clump later)
gwas <- gwas[gwas$Pval_Estimate < 5e-6, ]
# save list of suggestive SNPs for later
exp_dat <- format_data(gwas, type = "exposure",
snp_col = "SNP", beta_col = "est",
se_col = "se_c", effect_allele_col = "A1",
other_allele_col = "A2", pval_col = "Pval_Estimate",
samplesize_col = "N",
min_pval = 1e-200)
clumped_snps <- ieugwasr::ld_clump(dplyr::tibble(rsid=exp_dat$SNP, pval=exp_dat$pval.exposure, id=exp_dat$id.exposure),
plink_bin = "/Users/naveennainwal/Tools/plink_folder/plink", # genetics.binaRies::get_plink_binary(),
bfile = "/Users/naveennainwal/Tools/EUR/EUR",
clump_kb = 10000,
clump_r2 = 0.001,
clump_p = 0.00000005,
pop = "EUR" )
# keep only clumped snps
exp_dat_clumped <- subset(exp_dat, SNP %in% clumped_snps$rsid)
out <- read_outcome_data(
snps = exp_dat_clumped$SNP,
filename = paste0("oag_pheno_normalized_residualized.Metabolic_age_gap.glm.linear.gz"), # no eaf in sumstats
sep = "\t", snp_col = "ID",
beta_col = "BETA", se_col = "SE",
effect_allele_col = "ALT", other_allele_col = "REF",
pval_col = "P", eaf_col = 'EAF')
out <- read_outcome_data(
snps = exp_dat_clumped$SNP,
filename = paste0("sumstats/oag_pheno_normalized_residualized.Metabolic_age_gap.glm.linear.gz"), # no eaf in sumstats
sep = "\t", snp_col = "ID",
beta_col = "BETA", se_col = "SE",
effect_allele_col = "ALT", other_allele_col = "REF",
pval_col = "P", eaf_col = 'EAF')
out$outcome <- "Metabolic-BAG"
head(out)
dat <- harmonise_data(
exposure_dat = exp_dat_clumped,
outcome_dat = out)
dat
dim(day)
dim(dat)
egger_intercept_b <- mr_pleiotropy_test(dat)
# Heterogeneity statistic
Q_b <- mr_heterogeneity(dat)
res <- mr(dat, method_list = c("mr_ivw", "mr_weighted_median", "mr_egger_regression"))
# save all output
openxlsx::write.xlsx(list(res = res, egger_intercept = egger_intercept_b, Q_df = Q_b), file = paste0("results/brainageFactor-on-metabolic-wen-", Sys.Date(), ".xlsx"), rowNames = F, overwrite = T)
#
res
Sys.Date()
View(dat)
0.00000005 / 300
0.00000005 * 300
0.00000005 / 320
0.00000005 / 400
0.00000005 / 500
longevity_results = MRlap(exposure = longevity,
exposure_name = "Longevity_90th",
outcome = brainage,
outcome_name = "brainageFactor",
ld = "eur_w_ld_chr",
hm3 = "w_hm3.snplist",
MR_plink = genetics.binaRies::get_plink_binary(),
MR_bfile = "/campaign/VB-FM5HPC-001/Vilte/Projects/MR-mediation/metabolites/EUR/EUR",
MR_threshold = 5e-6,
MR_pruning_LD = 0.001,
MR_pruning_dist = 1000,
)
message("Saving imputed data as ", paste0(output, 'DNAm.imputed_', name, '.rds'))
name="F7_cord"
message("Saving imputed data as ", paste0('DNAm.imputed_', name, '.rds'))
